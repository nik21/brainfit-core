#!/usr/bin/env php
<?php

error_reporting(E_ALL ^ E_NOTICE);

function includeIfExists($file)
{
    if (file_exists($file)) {
        return include $file;
    }
}

if ($loader = includeIfExists(__DIR__.'/../vendor/autoload.php'))
    define('ROOT',  dirname(__FILE__).'/../');
else if ($loader = includeIfExists(__DIR__.'/../../../autoload.php'))
    define('ROOT',  dirname(__FILE__).'/../../../../');
else
    die('Not found autoload.php...'.PHP_EOL);

include_once(ROOT.'engine/Default.php');

//If the input was not a parameter-c (child), this daemon runs. If you specify "-c", then wait for data to STDIN
//Additionally, the daemon mode available options -h and-p to specify the host and port

$obError = null;

try
{
    $obTaskManager = new \Brainfit\Util\TaskManager();
    $obTaskManager->run(getopt('h:p:c:d:'));
}catch (\Brainfit\Model\Exception $e)
{
    $obError = $e;
}
catch(\Exception $e)
{
    $obError = $e;
}

if (!is_null($obError))
{
    echo "Error: ".$obError->getMessage() . "(".$obError->getCode().')'.PHP_EOL;
}
